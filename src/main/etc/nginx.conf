worker_processes  1;

events {
    worker_connections  1024;
}

http {

    upstream sucheon_api {
    server localhost:2500 weight=1;
    }

    # add_header X-Upstream $upstream_addr always;
    # add_header Access-Control-Allow-Origin *;
    # add_header Access-Control-Allow-Headers X-Requested-With;
    # add_header Access-Control-Allow-Methods GET,POST,OPTIONS;

    sendfile        on;
    keepalive_timeout  65;
    gzip  on;
    server {
        listen       80;
        server_name  localhost;
        include      mime.types;

        location /api/ {
            index  index.html;
            root html;
            #这个比较重要，规定了/api/路径下的路由才会被代理
            rewrite ^/api/(.*)$ /$1 break;
            proxy_pass http://sucheon_api;
            #-------------------------------------------
            ssi on ;
            ssi_types text/shtml;
            proxy_read_timeout 300;
            proxy_connect_timeout 300;
            proxy_redirect     off;
            proxy_set_header   X-Forwarded-Proto $scheme;
            proxy_set_header   Host              $http_host;
            proxy_set_header   X-Real-IP         $remote_addr;

            default_type  application/octet-stream;
            add_header Access-Control-Allow-Origin *;
            add_header Access-Control-Allow-Headers X-Requested-With;
            add_header Access-Control-Allow-Methods GET,POST,OPTIONS;
        }

        error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }
}
